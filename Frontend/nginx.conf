# This block defines a "server" that listens on port 80 inside the container.
server {
    listen 80;
    server_name localhost;

    # --- Part 1: Serve the Static Frontend Files ---
    # This is the root directory where your static files are.
    # It matches the COPY command in your frontend Dockerfile.
    root /usr/share/nginx/html;
    index index.html index.htm;

    # This location block handles requests for the main webpage and other static assets.
    location / {
        try_files $uri $uri/ =404;
    }

    # --- Part 2: The Reverse Proxy for the Backend API ---
    # This location block matches any request that starts with /video_feed,
    # /upload_model, or any other API route you create.
    location ~ ^/(video_feed|upload_model) {
        # This is the magic line.
        # It forwards the request to the backend service.
        # "backend-api" is the service name from your docker-compose.yaml file.
        # Docker's internal DNS resolves this to the backend container's IP.
        # The port is 5000, as defined in your backend's CMD.
        proxy_pass http://backend-api:5000;

        # These headers are important for passing client information to the backend.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}