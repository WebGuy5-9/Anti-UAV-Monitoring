<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anti-UAV Monitoring</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables */
        :root {
            --blue-primary: #1a237e;
            --blue-primary-light: #534bae;
            --blue-primary-dark: #000051;
            --blue-secondary: #64b5f6;
            --blue-secondary-light: #9be7ff;
            --surface: #e3f2fd;
            --bg: #f5f7fa;
            --text-on-primary: #ffffff;
            --text-primary: #212121;
        }

        /* Base Styles */
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: "Roboto", sans-serif;
            background: var(--bg);
            color: var(--text-primary);
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .app-header {
            background: var(--blue-primary);
            color: var(--text-on-primary);
            padding: 1rem;
            text-align: center;
        }

        .app-header h1 {
            margin: 0;
            font-weight: 500;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-areas:
                "live detections"
                "live metrics"
                "live controls";
            grid-template-columns: 2fr 1fr;
            grid-template-rows: auto auto 1fr;
            gap: 1rem;
            padding: 1rem;
            flex: 1;
        }

        /* Panel Styles */
        .panel {
            background: var(--surface);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background: var(--blue-primary-light);
            color: var(--text-on-primary);
            padding: 0.5rem 1rem;
            font-weight: 500;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }

        /* Live Feed Panel */
        .live-feed-panel {
            grid-area: live;
            min-height: 400px;
        }

        .webcam-container {
            text-align: center;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            flex: 1;
        }

        .webcam-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: 2px solid #ccc;
            border-bottom-left-radius: 14px;
            border-bottom-right-radius: 14px;
        }

        .recording-controls {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .record-btn {
            padding: 8px 16px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .record-btn.start {
            background: #d32f2f;
        }

        .record-btn.stop {
            background: #388e3c;
        }

        /* Detections Panel */
        .detections-panel {
            grid-area: detections;
            overflow-y: auto;
        }

        .detections-table {
            width: 100%;
            border-collapse: collapse;
        }

        .detections-table th,
        .detections-table td {
            padding: 0.5rem;
            text-align: left;
        }

        .detections-table th {
            background: var(--blue-secondary);
            color: var(--text-on-primary);
        }

        .detections-table tr:nth-child(odd) {
            background: var(--blue-secondary-light);
        }

        /* Metrics Panel */
        .metrics-panel {
            grid-area: metrics;
        }

        .metrics-content {
            flex: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .metrics-row {
            display: flex;
            gap: 0.75rem;
        }

        .metric-card {
            flex: 1;
            background: var(--blue-primary-dark);
            color: var(--text-on-primary);
            padding: 1rem;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .metric-label {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .metric-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-on-primary);
        }

        /* Controls Panel */
        .controls-panel {
            grid-area: controls;
            padding: 1rem;
        }

        .control-item {
            display: flex;
            align-items: center;
            margin-top: 1rem;
            margin-bottom: 0.75rem;
        }

        .toggle-btn {
            margin-left: auto;
            background: var(--blue-primary);
            color: var(--text-on-primary);
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .slider {
            flex: 1;
            margin: 0 0.5rem;
        }

        .threshold-value {
            width: 2.5rem;
            text-align: right;
        }

        .control-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .action-btn {
            flex: 1;
            background: var(--blue-secondary);
            color: var(--text-on-primary);
            border: none;
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-areas:
                    "live"
                    "detections"
                    "metrics"
                    "controls";
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>Anti-UAV Monitoring</h1>
        </header>

        <main class="dashboard-grid">
            <!-- Live Feed Panel -->
            <section class="panel live-feed-panel">
                <div class="panel-header">Live Camera Feed</div>
                <div class="webcam-container">
                    <video id="webcamVideo" class="webcam-video" autoplay playsinline></video>
                    <div class="recording-controls">
                        <button id="recordBtn" class="record-btn start">Start Recording</button>
                    </div>
                </div>
            </section>

            <!-- Detections Table -->
            <section class="panel detections-panel">
                <div class="panel-header">Detections</div>
                <table class="detections-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Class</th>
                            <th>Confidence</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>Quad</td><td>94.08%</td></tr>
                        <tr><td>2</td><td>Hexa</td><td>89.22%</td></tr>
                        <tr><td>3</td><td>Octo</td><td>91.67%</td></tr>
                        <tr><td>1</td><td>Quad</td><td>94.08%</td></tr>
                        <tr><td>2</td><td>Hexa</td><td>89.22%</td></tr>
                        <tr><td>3</td><td>Octo</td><td>91.67%</td></tr>
                        <tr><td>1</td><td>Quad</td><td>94.08%</td></tr>
                        <tr><td>2</td><td>Hexa</td><td>89.22%</td></tr>
                        <tr><td>3</td><td>Octo</td><td>91.67%</td></tr>
                        <tr><td>1</td><td>Quad</td><td>94.08%</td></tr>
                        <tr><td>2</td><td>Hexa</td><td>89.22%</td></tr>
                    </tbody>
                </table>
            </section>

            <!-- Metrics Panel -->
            <section class="panel metrics-panel">
                <div class="panel-header">Metrics</div>
                <div class="metrics-content">
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">FPS</div>
                            <div class="metric-value">25.4</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Avg Speed</div>
                            <div class="metric-value">4.2 px/frame</div>
                        </div>
                    </div>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Model</div>
                            <div class="metric-value">YOLOv8n.pt</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Drones</div>
                            <div class="metric-value">7</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Controls Panel -->
            <section class="panel controls-panel">
                <div class="panel-header">Controls</div>
                <div class="control-item">
                    <label>Tracking:</label>
                    <button class="toggle-btn" id="trackingBtn">ON</button>
                </div>
                <div class="control-item">
                    <label>Detection Threshold:</label>
                    <input
                        type="range"
                        min="0"
                        max="1"
                        step="0.01"
                        value="0.5"
                        class="slider"
                        id="thresholdSlider"
                    />
                    <span class="threshold-value" id="thresholdValue">0.50</span>
                </div>
                <div class="control-buttons">
                    <button class="action-btn" id="uploadBtn">Upload Video</button>
                    <button class="action-btn" id="downloadBtn">Download Logs</button>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Global variables
        let mediaRecorder;
        let recordedChunks = [];
        let isRecording = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeWebcam();
            initializeControls();
        });

        // Webcam functionality
        async function initializeWebcam() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                });
                const videoElement = document.getElementById('webcamVideo');
                videoElement.srcObject = stream;
            } catch (err) {
                console.error("Error accessing webcam: ", err);
                alert("Unable to access webcam. Please ensure you have granted camera permissions.");
            }
        }

        // Recording functionality
        function startRecording() {
            recordedChunks = [];
            const videoElement = document.getElementById('webcamVideo');
            const stream = videoElement.srcObject;
            
            mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });

            mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    recordedChunks.push(event.data);
                }
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, { type: "video/webm" });
                const url = URL.createObjectURL(blob);

                // Auto download
                const a = document.createElement("a");
                a.href = url;
                a.download = `recording_${Date.now()}.webm`;
                a.click();

                URL.revokeObjectURL(url);
            };

            mediaRecorder.start();
            isRecording = true;
            updateRecordButton();
        }

        function stopRecording() {
            if (mediaRecorder) {
                mediaRecorder.stop();
                isRecording = false;
                updateRecordButton();
            }
        }

        function updateRecordButton() {
            const recordBtn = document.getElementById('recordBtn');
            if (isRecording) {
                recordBtn.textContent = 'Stop Recording';
                recordBtn.className = 'record-btn stop';
            } else {
                recordBtn.textContent = 'Start Recording';
                recordBtn.className = 'record-btn start';
            }
        }

        // Initialize controls
        function initializeControls() {
            // Record button
            document.getElementById('recordBtn').addEventListener('click', () => {
                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            });

            // Tracking toggle
            document.getElementById('trackingBtn').addEventListener('click', function() {
                const isOn = this.textContent === 'ON';
                this.textContent = isOn ? 'OFF' : 'ON';
                this.style.background = isOn ? '#666' : 'var(--blue-primary)';
            });

            // Threshold slider
            const slider = document.getElementById('thresholdSlider');
            const valueDisplay = document.getElementById('thresholdValue');
            
            slider.addEventListener('input', function() {
                valueDisplay.textContent = parseFloat(this.value).toFixed(2);
            });

            // Upload video button
            document.getElementById('uploadBtn').addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'video/*';
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        alert(`Selected file: ${file.name}`);
                        // Handle video upload logic here
                    }
                };
                input.click();
            });

            // Download logs button
            document.getElementById('downloadBtn').addEventListener('click', function() {
                const logData = generateLogData();
                downloadFile('detection_logs.json', JSON.stringify(logData, null, 2));
            });
        }

        // Generate sample log data
        function generateLogData() {
            return {
                timestamp: new Date().toISOString(),
                detections: [
                    { id: 1, class: "Quad", confidence: 0.9408, timestamp: new Date().toISOString() },
                    { id: 2, class: "Hexa", confidence: 0.8922, timestamp: new Date().toISOString() },
                    { id: 3, class: "Octo", confidence: 0.9167, timestamp: new Date().toISOString() }
                ],
                metrics: {
                    fps: 25.4,
                    avgSpeed: 4.2,
                    model: "YOLOv8n.pt",
                    totalDrones: 7
                }
            };
        }

        // Download file utility
        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            const videoElement = document.getElementById('webcamVideo');
            if (videoElement.srcObject) {
                videoElement.srcObject.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>